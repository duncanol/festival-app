<head>
  <title>HappySadBored</title>
</head>

<body>

  <div style="float: right; margin-right:20px;">
    {{loginButtons align="right"}}
  </div>
  
  <h1>Happy<i>Sad</i><small>Bored</small></h1>
  
  <div class="info span12">
    <p class="alert alert-success">
      {{> topchat}}
    </p>
  </div>
  
  <div class="span12" style="clear: right;">
    <div class="well">
      {{> chatcontrol}}
    </div>
  </div>
  
  <div style="clear: left;">
    {{> chathistory}}
  </div>
  
  <div class="span12" style="clear: left;">
    <h4>Emotional leaderboard</h4>
    <div class="well" style="clear: right;">
      {{> chatstats}}
    </div>
  </div>
    
</body>


<template name="topchat">
  
  {{#with topTag}}
    The <strong>{{tag}} folk</strong> have it today!
  {{/with}}
  
</template>

<template name="chatcontrol">
  
  {{#unless permittedToSeeFullChats }}
    <p class="alert alert-info">Please log in (top RHS) to see full messages and authors and unlock other features!</p>
  {{/unless}}
  
  {{#if permittedToInsertChat }}
    <input type="text" id="chat-text" placeholder="How ya doing?" />
    <button class="chat-text-submit" data-tag="happy" data-category="emotion">Happy :)</button>
    <button class="chat-text-submit" data-tag="sad" data-category="emotion">Sad :(</button>
    <button class="chat-text-submit" data-tag="bored" data-category="emotion">Bored :|</button>
  {{/if}}
  
</template>

<template name="chathistory">
  
  {{#each mainTags}}
    <div class="span4">
      <div class="well">
        <h3>{{messagesCount tag}} {{tag}} folk</h3>
        <ul>
          {{#each messages tag}}
            <li class="chat-message" data-entry-id="{{_id}}" style="nth-of-type(even): text-align: right;">
              {{ text }} 
              <small class="chat-message muted">({{ authorUsername }} {{formattedDate}})</small>
              
              {{#if permittedToRemoveChat _id}} 
                {{#if deletingEntry ../_id}}
                  <a href="#" id="delete-entry" data-entry-id="{{../_id}}">Delete</a>
                {{/if}}
              {{/if}}
            </li>
          {{/each}}
        </ul>
      </div>    
    </div>
  {{/each}}
  
</template>

<template name="chatstats">

  {{#with topTag}}
    <div class="success">The <strong>{{tag}} folk</strong> have it today!</div>
  {{/with}}
  
  {{#each tags}}
    {{tag}}: {{count}}
    <span class="divider">//</span>
  {{/each}}  
  
</template>

